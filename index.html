<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>極簡 QR Code 掃描器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 QR Code 掃描核心函式庫 -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        /* 自定義掃描區域的樣式，覆蓋函式庫預設外觀 */
        #reader {
            border: none !important;
            border-radius: 1rem;
            overflow: hidden;
        }
        #reader__dashboard_section_csr button {
            background-color: #3b82f6 !important;
            color: white !important;
            padding: 0.5rem 1rem !important;
            border-radius: 0.5rem !important;
            border: none !important;
            cursor: pointer !important;
            margin: 5px !important;
            font-size: 14px !important;
        }
        #reader__camera_selection {
            padding: 8px !important;
            border-radius: 8px !important;
            border: 1px solid #ddd !important;
            margin: 10px 0 !important;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans">

    <div class="max-w-md mx-auto px-4 py-8">
        <!-- 標題區 -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">QR 掃描器</h1>
            <p class="text-slate-500">對準 QR Code 即可自動辨識</p>
        </div>

        <!-- 掃描容器 -->
        <div class="bg-white rounded-2xl shadow-xl p-4 mb-6">
            <div id="reader" class="w-full"></div>
        </div>

        <!-- 結果顯示區 -->
        <div id="result-container" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-300">
            <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
                <h2 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">掃描結果</h2>
                <div id="result-text" class="text-lg font-medium text-slate-800 break-all mb-4">
                    <!-- 這裡會顯示掃描到的內容 -->
                </div>
                
                <div class="flex gap-3">
                    <button onclick="copyToClipboard()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
                        複製內容
                    </button>
                    <button id="open-link-btn" class="hidden flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl shadow-md shadow-blue-200 transition-all duration-200 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                        前往連結
                    </button>
                </div>
            </div>
        </div>

        <!-- 提示區 -->
        <div class="mt-8 text-center text-slate-400 text-sm">
            提示：請確保環境光線充足，並授權相機權限。
        </div>
    </div>

    <!-- 提示框 (Toast) -->
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none text-sm font-medium">
        已複製到剪貼簿
    </div>

    <script>
        const resultContainer = document.getElementById('result-container');
        const resultText = document.getElementById('result-text');
        const openLinkBtn = document.getElementById('open-link-btn');
        const toast = document.getElementById('toast');

        let lastResult = "";

        // 檢查是否為網址
        function isURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // 成功掃描的回呼函式
        function onScanSuccess(decodedText, decodedResult) {
            // 避免重複處理相同的掃描結果
            if (decodedText === lastResult) return;
            lastResult = decodedText;

            // 震動回饋 (如果手機支援)
            if (navigator.vibrate) navigator.vibrate(100);

            // 顯示結果
            resultContainer.classList.remove('hidden');
            resultText.innerText = decodedText;

            // 判斷是否為連結，若是則顯示按鈕
            if (isURL(decodedText)) {
                openLinkBtn.classList.remove('hidden');
                openLinkBtn.onclick = () => window.open(decodedText, '_blank');
            } else {
                openLinkBtn.classList.add('hidden');
            }
            
            // 滾動到結果區
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function onScanFailure(error) {
            // 通常不需要處理掃描失敗，因為每秒都在嘗試辨識
        }

        // 初始化掃描器
        let html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", 
            { 
                fps: 15, 
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0 
            },
            /* verbose= */ false
        );
        
        html5QrcodeScanner.render(onScanSuccess, onScanFailure);

        // 複製功能
        function copyToClipboard() {
            const text = resultText.innerText;
            const tempInput = document.createElement("input");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // 顯示提示
            toast.style.opacity = "1";
            setTimeout(() => {
                toast.style.opacity = "0";
            }, 2000);
        }
    </script>
</body>
</html>
